#include "midi.h"
#include "note.h"
#include "jdksmidi/world.h"
#include "jdksmidi/midi.h"
#include "jdksmidi/msg.h"
#include "jdksmidi/sysex.h"
#include "jdksmidi/parser.h"

using namespace jdksmidi;

Midi::Midi(std::string address) : address(address)
{
}

Note **Midi::parse()
{
    Note notes[6][200] = {
        {{0,0,0},
             {1, 0, 45},
             {1, 144, 237},
             {1, 336, 429},
             {1, 528, 621},
             {1, 720, 765},
             {1, 1536, 1581},
             {1, 1680, 1773},
             {1, 2256, 2301},
             {1, 3072, 3117},
             {1, 3216, 3309},
             {1, 3408, 3501},
             {1, 3600, 3693},
             {1, 3792, 3837},
             {1, 4608, 4653},
             {1, 4752, 4845},
             {1, 5328, 5373},
             {1, 6144, 6189},
             {1, 6288, 6381},
             {1, 6480, 6573},
             {1, 6768, 6909},
             {1, 7296, 7389},
             {1, 7680, 7773},
             {1, 8256, 8349},
             {1, 9024, 9117},
             {1, 9792, 9885},
             {1, 10368, 10461},
             {1, 10752, 10845},
             {1, 11328, 11421},
             {1, 12096, 12189},
             {1, 12288, 12381},
             {1, 14832, 14925},
             {1, 16800, 16845},
             {1, 16896, 17133},
             {1, 17568, 17613},
             {1, 17664, 17925},
             {1, 17928, 17997},
             {1, 20352, 20445},
             {1, 20736, 20829},
             {1, 21312, 21405},
             {1, 22080, 22173},
             {1, 22848, 22941},
             {1, 23424, 23517},
             {1, 23808, 23901},
             {1, 24384, 24477},
             {1, 25152, 25245},
             {1, 25344, 25437},
             {1, 29088, 29181},
             {1, 29568, 29661},
             {1, 30624, 30717},
             {1, 31392, 31485},
             {1, 32256, 32397},
             {1, 32400, 32445},
             {1, 32448, 32589},
             {1, 32928, 33021},
             {1, 34560, 34701},
             {1, 34992, 35085},
             {1, 36864, 36957},
             {1, 38928, 38973},
             {1, 40320, 40413},
             {1, 40896, 40989}
             },{
             {2, 48, 93},
             {2, 240, 285},
             {2, 432, 477},
             {2, 624, 669},
             {2, 768, 813},
             {2, 912, 1005},
             {2, 1104, 1197},
             {2, 1296, 1389},
             {2, 1488, 1533},
             {2, 1584, 1629},
             {2, 1776, 1821},
             {2, 1872, 1965},
             {2, 2064, 2157},
             {2, 2304, 2349},
             {2, 2448, 2541},
             {2, 2688, 2733},
             {2, 2880, 2925},
             {2, 3120, 3165},
             {2, 3312, 3357},
             {2, 3504, 3549},
             {2, 3696, 3741},
             {2, 3840, 3885},
             {2, 3984, 4077},
             {2, 4176, 4269},
             {2, 4368, 4461},
             {2, 4560, 4605},
             {2, 4656, 4701},
             {2, 4848, 4893},
             {2, 4944, 5037},
             {2, 5136, 5229},
             {2, 5376, 5421},
             {2, 5520, 5613},
             {2, 5712, 5805},
             {2, 5904, 5997},
             {2, 6192, 6237},
             {2, 6384, 6429},
             {2, 6672, 6765},
             {2, 7176, 7293},
             {2, 7392, 7485},
             {2, 7776, 7869},
             {2, 7872, 7965},
             {2, 8064, 8157},
             {2, 8160, 8253},
             {2, 8352, 8637},
             {2, 8784, 8829},
             {2, 8832, 8925},
             {2, 8928, 8973},
             {2, 8928, 8973},
             {2, 8976, 9021},
             {2, 9120, 9213},
             {2, 9600, 9693},
             {2, 9696, 9789},
             {2, 9888, 10173},
             {2, 10248, 10365},
             {2, 10464, 10557},
             {2, 10848, 10941},
             {2, 10944, 11037},
             {2, 11136, 11229},
             {2, 11232, 11325},
             {2, 11856, 11901},
             {2, 11904, 11997},
             {2, 12000, 12045},
             {2, 12000, 12045},
             {2, 12048, 12093},
             {2, 12192, 12285},
             {2, 12480, 12573},
             {2, 12672, 12765},
             {2, 14496, 14541},
             {2, 14592, 14829},
             {2, 14928, 15021},
             {2, 15120, 15213},
             {2, 16488, 16581},
             {2, 16584, 16677},
             {2, 16680, 16749},
             {2, 16752, 16797},
             {2, 16848, 16893},
             {2, 17136, 17229},
             {2, 17520, 17565},
             {2, 17616, 17661},
             {2, 18000, 18093},
             {2, 18192, 18285},
             {2, 18744, 18789},
             {2, 18984, 19053},
             {2, 19488, 19533},
             {2, 19824, 19869},
             {2, 20256, 20349},
             {2, 20448, 20541},
             {2, 20832, 20925},
             {2, 20928, 21021},
             {2, 21120, 21213},
             {2, 21216, 21309},
             {2, 21408, 21693},
             {2, 21840, 21885},
             {2, 21888, 21981},
             {2, 21984, 22029},
             {2, 21984, 22029},
             {2, 22032, 22077},
             {2, 22176, 22269},
             {2, 22656, 22749},
             {2, 22752, 22845},
             {2, 22944, 23229},
             {2, 23304, 23421},
             {2, 23520, 23613},
             {2, 23904, 23997},
             {2, 24000, 24093},
             {2, 24192, 24285},
             {2, 24288, 24381},
             {2, 24480, 24765},
             {2, 24912, 24957},
             {2, 24960, 25053},
             {2, 25056, 25101},
             {2, 25056, 25101},
             {2, 25104, 25149},
             {2, 25248, 25341},
             {2, 25536, 25629},
             {2, 25728, 25821},
             {2, 28992, 29085},
             {2, 29184, 29325},
             {2, 29328, 29349},
             {2, 29352, 29373},
             {2, 29376, 29517},
             {2, 29520, 29541},
             {2, 29544, 29565},
             {2, 29664, 29757},
             {2, 30432, 30525},
             {2, 30528, 30621},
             {2, 30720, 30861},
             {2, 30864, 30909},
             {2, 30912, 31053},
             {2, 31104, 31197},
             {2, 31296, 31389},
             {2, 31488, 31629},
             {2, 31632, 31677},
             {2, 31680, 31821},
             {2, 31824, 31869},
             {2, 31872, 31965},
             {2, 32064, 32205},
             {2, 32208, 32253},
             {2, 32592, 32637},
             {2, 32640, 32733},
             {2, 32832, 32925},
             {2, 33024, 33117},
             {2, 33216, 33357},
             {2, 34272, 34365},
             {2, 34464, 34557},
             {2, 34704, 34749},
             {2, 34752, 34893},
             {2, 35088, 35181},
             {2, 35712, 35853},
             {2, 35856, 35901},
             {2, 36000, 36093},
             {2, 36480, 36573},
             {2, 36576, 36621},
             {2, 36624, 36669},
             {2, 36672, 36765},
             {2, 36960, 37005},
             {2, 37008, 37053},
             {2, 37056, 37149},
             {2, 37248, 37341},
             {2, 37344, 37389},
             {2, 37392, 37437},
             {2, 37440, 37533},
             {2, 37920, 38013},
             {2, 38400, 38541},
             {2, 38544, 38589},
             {2, 38592, 38685},
             {2, 38784, 38877},
             {2, 38976, 39021},
             {2, 39744, 39837},
             {2, 39936, 40029},
             {2, 40128, 40221},
             {2, 40512, 40605},
             {2, 40992, 41085},
             {2, 41472, 41565},
             {2, 41664, 41757},
             {2, 41856, 41949},
             {2, 42192, 42237},
             {2, 42240, 43005}
             },{
             {3, 96, 141},
             {3, 288, 333},
             {3, 480, 525},
             {3, 672, 717},
             {3, 816, 861},
             {3, 1008, 1053},
             {3, 1200, 1245},
             {3, 1392, 1437},
             {3, 1632, 1677},
             {3, 1824, 1869},
             {3, 1968, 2013},
             {3, 2160, 2205},
             {3, 2352, 2397},
             {3, 2544, 2589},
             {3, 2640, 2685},
             {3, 2784, 2877},
             {3, 2928, 2973},
             {3, 3024, 3069},
             {3, 3168, 3213},
             {3, 3360, 3405},
             {3, 3552, 3597},
             {3, 3744, 3789},
             {3, 3888, 3933},
             {3, 4080, 4125},
             {3, 4272, 4317},
             {3, 4464, 4509},
             {3, 4704, 4749},
             {3, 4896, 4941},
             {3, 5040, 5085},
             {3, 5232, 5277},
             {3, 5424, 5469},
             {3, 5616, 5661},
             {3, 5808, 5853},
             {3, 6000, 6045},
             {3, 6096, 6141},
             {3, 6240, 6285},
             {3, 6432, 6477},
             {3, 6624, 6669},
             {3, 6912, 7173},
             {3, 7488, 7581},
             {3, 7968, 8061},
             {3, 9216, 9309},
             {3, 9504, 9597},
             {3, 10560, 10653},
             {3, 11040, 11133},
             {3, 12384, 12477},
             {3, 12768, 12861},
             {3, 12960, 13245},
             {3, 13728, 13821},
             {3, 13824, 14397},
             {3, 14448, 14493},
             {3, 14544, 14589},
             {3, 15024, 15117},
             {3, 15216, 15309},
             {3, 15360, 15597},
             {3, 15648, 15693},
             {3, 16128, 16389},
             {3, 16392, 16485},
             {3, 17232, 17325},
             {3, 17424, 17517},
             {3, 18096, 18189},
             {3, 18288, 18381},
             {3, 18432, 18741},
             {3, 18792, 18933},
             {3, 19056, 19101},
             {3, 19200, 19389},
             {3, 19440, 19485},
             {3, 19536, 19629},
             {3, 19728, 19821},
             {3, 19872, 19917},
             {3, 19968, 20253},
             {3, 20544, 20637},
             {3, 21024, 21117},
             {3, 22272, 22365},
             {3, 22560, 22653},
             {3, 23616, 23709},
             {3, 24096, 24189},
             {3, 24864, 24909},
             {3, 25440, 25533},
             {3, 25824, 25917},
             {3, 26016, 26301},
             {3, 28896, 28989},
             {3, 29760, 29853},
             {3, 29952, 30093},
             {3, 30336, 30429},
             {3, 31056, 31101},
             {3, 31200, 31293},
             {3, 31968, 32061},
             {3, 32736, 32829},
             {3, 33120, 33213},
             {3, 33360, 33405},
             {3, 33552, 33597},
             {3, 33600, 33693},
             {3, 33792, 33933},
             {3, 34176, 34269},
             {3, 34368, 34461},
             {3, 34896, 34941},
             {3, 35184, 35229},
             {3, 35664, 35709},
             {3, 35904, 35997},
             {3, 36096, 36285},
             {3, 36288, 36381},
             {3, 36384, 36429},
             {3, 36432, 36477},
             {3, 36768, 36861},
             {3, 37152, 37245},
             {3, 37536, 37581},
             {3, 37632, 37821},
             {3, 37824, 37917},
             {3, 38016, 38109},
             {3, 38208, 38301},
             {3, 38304, 38397},
             {3, 38736, 38781},
             {3, 38880, 38925},
             {3, 39024, 39069},
             {3, 39552, 39645},
             {3, 40704, 40797},
             {3, 41088, 41181},
             {3, 41280, 41373},
             {3, 41568, 41661},
             {3, 41760, 41853},
             {3, 41952, 42045},
             {3, 42144, 42189}},
             {
             {4, 864, 909},
             {4, 1056, 1101},
             {4, 1248, 1293},
             {4, 1440, 1485},
             {4, 2016, 2061},
             {4, 2208, 2253},
             {4, 2400, 2445},
             {4, 2592, 2637},
             {4, 2736, 2781},
             {4, 2976, 3021},
             {4, 3936, 3981},
             {4, 4128, 4173},
             {4, 4320, 4365},
             {4, 4512, 4557},
             {4, 5088, 5133},
             {4, 5280, 5325},
             {4, 5472, 5517},
             {4, 5664, 5709},
             {4, 5856, 5901},
             {4, 6048, 6093},
             {4, 6576, 6621},
             {4, 7584, 7677},
             {4, 8736, 8781},
             {4, 9312, 9405},
             {4, 9408, 9501},
             {4, 10656, 10749},
             {4, 11808, 11853},
             {4, 12576, 12669},
             {4, 12864, 12957},
             {4, 13680, 13725},
             {4, 15312, 15357},
             {4, 15696, 16029},
             {4, 17328, 17421},
             {4, 18384, 18429},
             {4, 19104, 19149},
             {4, 19152, 19197},
             {4, 19632, 19725},
             {4, 19920, 19965},
             {4, 20640, 20733},
             {4, 21792, 21837},
             {4, 22368, 22461},
             {4, 22464, 22557},
             {4, 23712, 23805},
             {4, 25632, 25725},
             {4, 25920, 26013},
             {4, 28800, 28893},
             {4, 29856, 29949},
             {4, 30096, 30141},
             {4, 30144, 30285},
             {4, 30288, 30333},
             {4, 33408, 33549},
             {4, 33696, 33789},
             {4, 33936, 33981},
             {4, 33984, 34125},
             {4, 34128, 34173},
             {4, 34944, 34989},
             {4, 35232, 35325},
             {4, 35328, 35469},
             {4, 35472, 35517},
             {4, 35520, 35661},
             {4, 37584, 37629},
             {4, 38112, 38205},
             {4, 38688, 38733},
             {4, 39072, 39165},
             {4, 39168, 39357},
             {4, 39360, 39453},
             {4, 39456, 39501},
             {4, 39504, 39549},
             {4, 39648, 39693},
             {4, 39696, 39741},
             {4, 39840, 39885},
             {4, 39888, 39933},
             {4, 40032, 40077},
             {4, 40080, 40125},
             {4, 40224, 40269},
             {4, 40272, 40317},
             {4, 40416, 40461},
             {4, 40464, 40509},
             {4, 40608, 40653},
             {4, 40656, 40701},
             {4, 40800, 40845},
             {4, 40848, 40893},
             {4, 41184, 41277},
             {4, 41376, 41469},
             {4, 42048, 42141}
             },{0,0,0}
    };
    return (Note **)notes;
}
//    FILE *out = fopen("parse.out", "w");
//    MIDIParser p(32 * 1024);
//    MIDITimedBigMessage m;
//    FILE *f = fopen(address.c_str(), "r");

//    while (!feof(f))
//    {
//        int c = fgetc(f);

//        if (c == EOF)
//            break;

//        if (p.Parse((uchar)c, &m))
//        {
//            // 84-88
////            if (m.IsNote() && m.GetNote() <= 88)
//            {
//                fprintf(out, "%d\t%s\t%d\n", m.GetTime(), m.IsNoteOn() ? "On" : "Off", m.GetNote() - 83);
//            }
//        }
//    }
